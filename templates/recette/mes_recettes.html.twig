{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} - Mes recettes{% endblock %}

{% block stylesheets %}{{ parent() }}{% endblock %}

{% block header_title %}Votre espace personnel{% endblock %}
{% block header_subtitle %}Consultez et ajoutez vos propres recettes !{% endblock %}
{% block header_tabs %}
	<li {% if action is defined and action == 'recettes' %}class="is-active"{% endif %}><a href="{{ path('mes_recettes') }}">Mes recettes</a></li>
    <li {% if action is defined and action == 'recettes_new' %}class="is-active"{% endif %}><a href="{{ path('mes_recettes_new') }}">Ajouter une recette</a></li>
{% endblock %}
{% block header_image %}{{ asset('icons/default1.jpg') }}{% endblock %}

{% block content %}
<div class="container">

    {% if action is defined and action == 'recettes' %}
        {% if recettes is defined %}
            <div class="columns is-multiline">
            {% for recette in recettes %}
                <div class="column is-4">
                    <div class="card">
                        <div class="card-image">
                            <figure class="image is-4by3">
                                <a href="{{ path('recette_show', {'id': recette.id}) }}">
                                        <img src="
                                        {% if recette.image is null %}
                                            https://bulma.io/images/placeholders/1280x960.png
                                        {% else %}
                                            {{ asset('uploads/images/'~recette.image) }}
                                        {% endif %}
                                    " alt="Placeholder image">
                                </a>
                            </figure>
                        </div>
                        <div class="card-content">
                            <div class="media">
                                <div class="media-content">
                                    <p class="title is-4">{{ recette.titre }}</p>
                                    <p class="subtitle is-6">publié par<a> @{{ recette.user.username }}</a></p>
                                </div>
                            </div>
                        </div>
                        <footer class="card-footer">
                            <div class="card-footer-item">
                                    <span class="icon is-small" style="margin-right: 4px;">
                                        <i class="fas fa-user"></i>
                                    </span>
                                    {{ recette.nbPersonnes }}
                            </div>
                            <div class="card-footer-item">
                                    <span class="icon is-small" style="margin-right: 4px;">
                                      <i class="fas fa-stopwatch"></i>
                                    </span>
                                {{ recette.tempsPreparation }}
                            </div>
                            <div class="card-footer-item">
                                    <span class="icon is-small" style="margin-right: 4px;">
                                      <i class="fas fa-star"></i>
                                    </span>
                                0
                            </div>
                            <div class="card-footer-item">
                                    <span class="icon is-small" style="margin-right: 4px;">
                                      <i class="fas fa-comment"></i>
                                    </span>
                                0
                            </div>
                        </footer>
                        </div>
                </div>
            {% endfor %}
            </div>
        {% endif %}
    {% else %}

        <form class="columns is-multiline" style="padding-left: 7px" enctype="multipart/form-data" action="{{ path('ajout_recette') }}" method="post" >
                <div class="column is-12">
                    <h4 class="title is-4">
                        <span class="icon">
                            <i class="fas fa-info-circle"></i>
                        </span>
                        Informations sur la recette
                    </h4>
                    <div class="field has-addons">
                        <p class="control has-icons-left">
                            <input class="input" placeholder="Nom de la recette" id="username" name="_titre" required>
                            <span class="icon is-small is-left">
                              <i class="fas fa-book"></i>
                            </span>
                        </p>
                        <div class="file">
                            <label class="file-label">
                                <input class="file-input" id="new_recette_image" name="new_recette[image]" type="file">
                                <span class="file-cta">
                                  <span class="file-icon">
                                    <i class="fas fa-upload"></i>
                                  </span>
                                  <span class="file-label">
                                    Aperçu
                                  </span>
                                </span>
                            </label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="control has-icons-left">
                            <div class="select">
                                <select id="categorie" name="_categorie">
                                    <option value="Entree" selected>Entrée</option>
                                    <option value="Plat">Plat</option>
                                    <option value="Dessert">Dessert</option>
                                </select>
                            </div>
                            <span class="icon is-left">
                                <i class="fas fa-align-left"></i>
                            </span>
                        </div>
                    </div>
                    <div class="field">
                        <div class="control has-icons-left">
                            <div class="select">
                                <select id="nbPersonnes" name="_nbPersonnes">
                                    {% for i in range(1,12,1) %}
                                        <option value="{{i}}">{{i}} pers.</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <span class="icon is-left">
                            <i class="fas fa-user"></i>
                        </span>
                        </div>
                    </div>
                    <div class="field">
                        <div class="control has-icons-left">
                            <div class="select">
                                <select id="tempsPrepa" name="_tempsPrepa">
                                    {% for i in range(5,120,5) %}
                                        <option value="{{i}}">{{i}} min</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <span class="icon is-left">
                            <i class="fas fa-stopwatch"></i>
                        </span>
                        </div>
                    </div>
                </div>
            <div class="column is-12"><hr></div>
                <div class="column is-12">
                    <h4 class="title is-4">
                        <span class="icon">
                            <i class="fas fa-lemon"></i>
                        </span>
                        Ingrédients
                    </h4>
                    <table class="table is-striped is-hoverable">
                        <thead>
                        <tr>
                            <th width="300px">Nom</th>
                            <th>Quantité</th>
                            <th>Unité</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th width="300px"></th>
                                <th></th>
                                <th></th>
                                <th>
                                    <div class="button" onclick="addIngredientNode()">
                                      <span class="icon is-left">
                                        <i class="fas fa-plus"></i>
                                      </span>
                                    </div>
                                </th>
                            </tr>
                        </tfoot>
                        <tbody id="ingredients">
                        <tr>
                            <td><input type='text' class='input' placeholder='Salade, tomate, oignon, ...' name='ingredients[0][]'></td>
                            <td><input type='number' min='0' value='0' class='input' name='ingredients[0][]'></td>
                            <td><input type='text' class='input' placeholder='kg, ...' name='ingredients[0][]'></td>
                            <td>
                                <div class="button" onclick="deleteIngredientNode(this)">
                                  <span class="icon is-left">
                                    <i class="fas fa-minus"></i>
                                  </span>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            <div class="column is-12"><hr></div>
                <div class="column is-12">
                    <h4 class="title is-4">
                        <span class="icon">
                            <i class="fas fa-play-circle"></i>
                        </span>
                        Étapes
                    </h4>
                    <div class="field">
                        <div class="control">
                            <textarea name="_etapes" class="textarea" placeholder="Décrivez les différentes étapes à suivre pour réaliser votre recette..." rows="10" required></textarea>
                        </div>
                    </div>
                </div>

            <div class="column is-12">
                <hr>
                <div class="field is-grouped is-grouped-right">
                    <p class="control">
                        <button type="submit" class="button is-danger">
                            Publier ma recette
                        </button>
                    </p>
                </div>
            </div>

            {% if error is defined and error %}
                <p class="help is-danger">{{ message }}</p>
                <p class="help is-danger">{{ dump(request) }}</p>
            {% endif %}
        </form>
    {% endif %}
</div>
{% endblock %}

{% block javascripts %}{{ parent() }}{% endblock %}
